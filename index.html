<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
      function getDistance(lat1, lng1, lat2, lng2) {
        const R = 6371;
        const dLat = deg2rad(lat2 - lat1);
        const dLng = deg2rad(lng2 - lng1);
        const a =
          Math.sin(dLat / 2) * Math.sin(dLat / 2) +
          Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLng / 2) * Math.sin(dLng / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c * 1000;
      }

      function deg2rad(deg) {
        return deg * (Math.PI / 180);
      }

      function getImageBasedOnLocation(latitude, longitude) {
        const locationA = { lat: 24.34031322856674, lng: 124.15835542423535 };
        const locationB = { lat: 24.337916686319687, lng: 124.16563584582616 };
        const distanceA = getDistance(latitude, longitude, locationA.lat, locationA.lng);
        const distanceB = getDistance(latitude, longitude, locationB.lat, locationB.lng);

        if (distanceA <= 10) {
          return 'imagea.png';
        } else if (distanceB <= 10) {
          return 'imageb.png';
        } else {
          return null;
        }
      }

      function initAR() {
        navigator.geolocation.getCurrentPosition((position) => {
          const { latitude, longitude } = position.coords;
          const imageSrc = getImageBasedOnLocation(latitude, longitude);

          if (imageSrc) {
            document.querySelector('#ar-image').setAttribute('src', imageSrc);
          } else {
            alert('ARマーカーが認識範囲外です。指定された座標の近くに移動してください。');
          }
        });
      }
    </script>
  </head>
  <body style="margin: 0; overflow: hidden;" onload="initAR()">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-marker type="pattern" url="pattern-shiroharaAR.patt">
        <a-image id="ar-image" position="0 0 0" scale="1 1 1"></a-image>
      </a-marker>
    </a-scene>
  </body>
</html>
